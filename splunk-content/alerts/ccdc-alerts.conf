# CCDC Splunk Alerts (Saved Searches)
# Import via: Settings > Searches, reports, and alerts > Import
# Or copy to $SPLUNK_HOME/etc/apps/search/local/savedsearches.conf

#=============================================================================
# AUTHENTICATION ALERTS
#=============================================================================

[CCDC - Multiple Failed Logins]
search = index=security sourcetype=linux_secure ("Failed password" OR "authentication failure") | stats count by src_ip, user | where count > 5
dispatch.earliest_time = -15m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 4
alert.track = 1
alert_condition = search count > 0
description = Detects brute force login attempts (>5 failures in 15 min)

[CCDC - Windows Failed Logins]
search = index=security sourcetype="WinEventLog:Security" EventCode=4625 | stats count by src_ip, user | where count > 5
dispatch.earliest_time = -15m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 4
alert.track = 1
alert_condition = search count > 0
description = Detects Windows brute force login attempts

[CCDC - Successful Root/Admin Login]
search = (index=security sourcetype=linux_secure "session opened" user=root) OR (index=security sourcetype="WinEventLog:Security" EventCode=4624 user=Administrator)
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 3
alert.track = 1
alert_condition = search count > 0
description = Alert on any root/Administrator login

[CCDC - Login from New IP]
search = index=security ("Accepted password" OR "Accepted publickey" OR EventCode=4624) | stats earliest(_time) as first_seen, count by src_ip | where first_seen > relative_time(now(), "-1h")
dispatch.earliest_time = -24h
dispatch.latest_time = now
cron_schedule = 0 * * * *
enableSched = 1
alert.severity = 3
alert.track = 1
description = Detects logins from previously unseen IP addresses

[CCDC - SSH Login Outside Business Hours]
search = index=security sourcetype=linux_secure "Accepted" | where date_hour < 6 OR date_hour > 22
dispatch.earliest_time = -1h
dispatch.latest_time = now
cron_schedule = 0 * * * *
enableSched = 1
alert.severity = 3
alert.track = 1
description = SSH logins outside normal hours (6am-10pm)

#=============================================================================
# USER/ACCOUNT ALERTS
#=============================================================================

[CCDC - New User Created]
search = (index=security sourcetype=linux_secure "useradd" OR "adduser") OR (index=security sourcetype="WinEventLog:Security" EventCode=4720)
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 5
alert.track = 1
alert_condition = search count > 0
description = CRITICAL - New user account created

[CCDC - User Added to Privileged Group]
search = (index=security sourcetype=linux_secure ("added" AND ("sudo" OR "wheel" OR "admin"))) OR (index=security sourcetype="WinEventLog:Security" EventCode=4732 (TargetUserName="Administrators" OR TargetUserName="Domain Admins"))
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 5
alert.track = 1
description = CRITICAL - User added to admin/sudo group

[CCDC - Password Changed]
search = (index=security sourcetype=linux_secure "password changed") OR (index=security sourcetype="WinEventLog:Security" EventCode=4724)
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 4
alert.track = 1
description = Password change detected

[CCDC - Sudoers File Modified]
search = index=security sourcetype=linux_audit key=sudoers_changes
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 5
alert.track = 1
description = CRITICAL - Sudoers file modified

#=============================================================================
# PERSISTENCE ALERTS
#=============================================================================

[CCDC - Cron Job Modified]
search = index=security sourcetype=linux_audit key=cron
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 5
alert.track = 1
description = CRITICAL - Cron job created or modified

[CCDC - Systemd Service Modified]
search = index=security sourcetype=linux_audit key=systemd
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 5
alert.track = 1
description = CRITICAL - Systemd service created or modified

[CCDC - Windows Scheduled Task Created]
search = index=security sourcetype="WinEventLog:TaskScheduler" EventCode=106
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 5
alert.track = 1
description = CRITICAL - New Windows scheduled task created

[CCDC - Windows Service Created]
search = index=security sourcetype="WinEventLog:System" EventCode=7045
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 5
alert.track = 1
description = CRITICAL - New Windows service installed

[CCDC - SSH Config Modified]
search = index=security sourcetype=linux_audit key=sshd_config
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 5
alert.track = 1
description = CRITICAL - SSH configuration modified

#=============================================================================
# NETWORK ALERTS
#=============================================================================

[CCDC - Suspicious Outbound Connection]
search = index=ccdc sourcetype=ccdc_network_monitor ("EXTERNAL" OR "SUSPICIOUS") | dedup dest_ip
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 5
alert.track = 1
description = CRITICAL - Suspicious outbound network connection detected

[CCDC - Reverse Shell Ports]
search = index=ccdc sourcetype=ccdc_network_monitor (dest_port=4444 OR dest_port=5555 OR dest_port=6666 OR dest_port=1234 OR dest_port=1337)
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 5
alert.track = 1
description = CRITICAL - Connection to common reverse shell port

[CCDC - New Listening Port]
search = index=ccdc sourcetype=ccdc_network_monitor "NEW_LISTENER"
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 4
alert.track = 1
description = New listening port detected on system

#=============================================================================
# PROCESS/EXECUTION ALERTS
#=============================================================================

[CCDC - Suspicious Process Execution]
search = index=security sourcetype=linux_audit key=exec (exe="/bin/nc" OR exe="/usr/bin/nc" OR exe="/bin/ncat" OR exe="/usr/bin/wget" OR exe="/usr/bin/curl" OR exe="/bin/bash -i" OR exe="python -c")
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 4
alert.track = 1
description = Suspicious command execution (netcat, wget, curl with shell)

[CCDC - PowerShell Suspicious Activity]
search = index=security sourcetype="WinEventLog:PowerShell:Operational" (ScriptBlockText="*Invoke-Expression*" OR ScriptBlockText="*IEX*" OR ScriptBlockText="*downloadstring*" OR ScriptBlockText="*EncodedCommand*" OR ScriptBlockText="*-enc*")
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 5
alert.track = 1
description = CRITICAL - Suspicious PowerShell activity detected

[CCDC - Binary Modified in System Path]
search = index=security sourcetype=linux_audit (path="/bin/*" OR path="/sbin/*" OR path="/usr/bin/*" OR path="/usr/sbin/*") type=CREATE
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 5
alert.track = 1
description = CRITICAL - Binary created/modified in system path

[CCDC - SUID Binary Created]
search = index=ccdc sourcetype=ccdc_file_monitor "SUID"
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 5
alert.track = 1
description = CRITICAL - New SUID binary detected

#=============================================================================
# WEB SERVER ALERTS
#=============================================================================

[CCDC - Web Shell Indicators]
search = index=web (uri="*cmd*" OR uri="*shell*" OR uri="*c99*" OR uri="*r57*" OR uri="*phpinfo*" OR uri="*eval*" OR uri="*base64*" OR uri="*system(*")
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 5
alert.track = 1
description = CRITICAL - Possible web shell access detected

[CCDC - SQL Injection Attempt]
search = index=web (uri="*UNION*SELECT*" OR uri="*OR%201=1*" OR uri="*'%20OR%20'*" OR uri="*;DROP*" OR uri="*--*")
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 4
alert.track = 1
description = Possible SQL injection attempt detected

[CCDC - Web Server Error Spike]
search = index=web status>=500 | stats count | where count > 50
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 3
alert.track = 1
description = High number of web server errors (>50 in 5 min)

[CCDC - Directory Traversal Attempt]
search = index=web (uri="*..*" OR uri="*%2e%2e*")
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 4
alert.track = 1
description = Directory traversal attempt detected

#=============================================================================
# DATABASE ALERTS
#=============================================================================

[CCDC - Database Error]
search = index=database sourcetype=mysql_error (ERROR OR "Access denied")
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 3
alert.track = 1
description = Database error detected

[CCDC - Database Auth Failure]
search = index=database "Access denied for user"
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 4
alert.track = 1
description = Database authentication failure

#=============================================================================
# MAIL SERVER ALERTS
#=============================================================================

[CCDC - Mail Server Auth Failure]
search = index=mail ("authentication failed" OR "auth failed" OR "SASL LOGIN authentication failed")
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 3
alert.track = 1
description = Mail server authentication failure

[CCDC - Mass Mail Sending]
search = index=mail "status=sent" | stats count by from | where count > 100
dispatch.earliest_time = -15m
dispatch.latest_time = now
cron_schedule = */15 * * * *
enableSched = 1
alert.severity = 4
alert.track = 1
description = Possible spam - high volume mail sending

#=============================================================================
# SYSTEM ALERTS
#=============================================================================

[CCDC - Kernel Module Loaded]
search = index=security sourcetype=linux_audit key=modules
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 5
alert.track = 1
description = CRITICAL - Kernel module loaded

[CCDC - Firewall Rule Changed]
search = index=os (iptables OR firewall-cmd OR ufw) AND (INSERT OR APPEND OR DELETE)
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 4
alert.track = 1
description = Firewall rule modified

[CCDC - Log Cleared]
search = index=security sourcetype="WinEventLog:Security" EventCode=1102
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 5
alert.track = 1
description = CRITICAL - Windows Security log cleared

[CCDC - Toolkit Finding]
search = index=ccdc sourcetype=ccdc_findings
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 4
alert.track = 1
description = CCDC toolkit detected a security finding

#=============================================================================
# FAIL2BAN ALERTS
#=============================================================================

[CCDC - Fail2Ban IP Banned]
search = index=security sourcetype=fail2ban "Ban"
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.severity = 3
alert.track = 1
description = Fail2ban banned an IP address
